<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AtlasFit • E-commerce Fitness (Fictício)</title>
  <meta name="description" content="Loja fictícia de materiais fitness: pesos, yoga, acessórios, recuperação e mais. Catálogo com carrinho e checkout simulado." />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <style>
    :root{color-scheme: light;}
    html{scroll-behavior:smooth;}
    .glass{backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);}
    .no-scrollbar::-webkit-scrollbar{display:none;}
    .no-scrollbar{-ms-overflow-style:none; scrollbar-width:none;}
    .focus-ring:focus{outline:none; box-shadow: 0 0 0 3px rgba(59,130,246,.35);}
  </style>
</head>
<body class="bg-slate-50 text-slate-900">
  <!-- Top notice -->
  <div class="bg-slate-900 text-slate-100">
    <div class="mx-auto max-w-7xl px-4 py-2 text-sm flex items-center justify-between gap-3">
      <p class="truncate">Frete fictício grátis acima de <span class="font-semibold">R$ 199</span> • Troca em até 30 dias • Pagamento seguro (simulado)</p>
      <button id="btnOpenCartTop" class="rounded-lg bg-white/10 hover:bg-white/15 px-3 py-1.5 text-xs font-semibold focus-ring" aria-label="Abrir carrinho">
        Abrir carrinho
      </button>
    </div>
  </div>

  <!-- Header -->
  <header class="sticky top-0 z-40 border-b border-slate-200 bg-white/75 glass">
    <div class="mx-auto max-w-7xl px-4 py-3">
      <div class="flex items-center justify-between gap-4">
        <a href="#inicio" class="flex items-center gap-2 group" aria-label="Ir para o início">
          <div class="size-10 rounded-xl bg-gradient-to-br from-blue-600 to-emerald-500 grid place-items-center text-white font-black">
            AF
          </div>
          <div class="leading-tight">
            <div class="font-extrabold tracking-tight text-slate-900">AtlasFit</div>
            <div class="text-xs text-slate-500 -mt-0.5">O melhor para você</div>
          </div>
        </a>

        <nav class="hidden md:flex items-center gap-1 text-sm">
          <a class="px-3 py-2 rounded-lg hover:bg-slate-100" href="#produtos">Produtos</a>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-100" href="#ofertas">Ofertas</a>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-100" href="#sobre">Sobre</a>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-100" href="#contato">Contato</a>
        </nav>

        <div class="flex items-center gap-2">
          <button id="btnOpenCart" class="relative rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-3 py-2 text-sm font-semibold focus-ring" aria-label="Abrir carrinho">
            <span class="inline-flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.72a2 2 0 0 0 2-1.58l1.2-6.42H6.1"/></svg>
              Carrinho
            </span>
            <span id="cartCountBadge" class="absolute -top-2 -right-2 min-w-6 h-6 px-2 rounded-full bg-slate-900 text-white text-xs grid place-items-center font-bold">0</span>
          </button>

          <button id="btnMobileMenu" class="md:hidden rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-3 py-2 focus-ring" aria-label="Abrir menu">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/></svg>
          </button>
        </div>
      </div>

      <!-- Mobile menu -->
      <div id="mobileMenu" class="md:hidden hidden pt-3">
        <div class="grid gap-2 text-sm">
          <a class="px-3 py-2 rounded-lg hover:bg-slate-100" href="#produtos">Produtos</a>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-100" href="#ofertas">Ofertas</a>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-100" href="#sobre">Sobre</a>
          <a class="px-3 py-2 rounded-lg hover:bg-slate-100" href="#contato">Contato</a>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section id="inicio" class="relative overflow-hidden">
    <div class="absolute inset-0">
      <div class="absolute inset-0 bg-gradient-to-br from-slate-900 via-slate-900/95 to-slate-900/80"></div>
      <img alt="" class="absolute inset-0 w-full h-full object-cover opacity-25" src="https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&w=2000&q=70" />
    </div>

    <div class="relative mx-auto max-w-7xl px-4 py-16 md:py-20">
      <div class="grid md:grid-cols-2 gap-10 items-center">
        <div>
          <div class="inline-flex items-center gap-2 rounded-full bg-white/10 text-white px-3 py-1.5 text-xs font-semibold border border-white/15">
            <span class="inline-block size-2 rounded-full bg-emerald-400"></span>
            Loja fictícia • Demo interativa
          </div>
          <h1 class="mt-4 text-4xl md:text-5xl font-black tracking-tight text-white">
            Materiais fitness para treinar em casa, na academia e ao ar livre.
          </h1>
          <p class="mt-4 text-white/80 text-base md:text-lg">
            Explore pesos, elásticos, yoga, recuperação, acessórios e kits. Adicione ao carrinho e simule um checkout completo.
          </p>
          <div class="mt-6 flex flex-col sm:flex-row gap-3">
            <a href="#produtos" class="rounded-xl bg-white text-slate-900 px-5 py-3 font-bold hover:bg-slate-100 focus-ring text-center">Ver produtos</a>
            <button id="btnAutoFill" class="rounded-xl bg-white/10 text-white px-5 py-3 font-bold border border-white/15 hover:bg-white/15 focus-ring">
              Aplicar cupom demo
            </button>
          </div>

          <div class="mt-8 grid grid-cols-3 gap-3">
            <div class="rounded-2xl bg-white/10 border border-white/15 p-4">
              <div class="text-white font-extrabold text-lg">+30</div>
              <div class="text-white/70 text-xs">itens no catálogo</div>
            </div>
            <div class="rounded-2xl bg-white/10 border border-white/15 p-4">
              <div class="text-white font-extrabold text-lg">4,8★</div>
              <div class="text-white/70 text-xs">avaliação média</div>
            </div>
            <div class="rounded-2xl bg-white/10 border border-white/15 p-4">
              <div class="text-white font-extrabold text-lg">24h</div>
              <div class="text-white/70 text-xs">envio fictício</div>
            </div>
          </div>
        </div>

        <div class="md:justify-self-end">
          <div class="rounded-3xl border border-white/15 bg-white/10 p-5">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-white font-extrabold">Destaques da semana</div>
                <div class="text-white/70 text-sm">Seleção de itens populares</div>
              </div>
              <a href="#ofertas" class="text-sm font-semibold text-white hover:text-white/90">Ver ofertas →</a>
            </div>
            <div id="featuredRow" class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
          </div>

          <div class="mt-4 rounded-3xl bg-white p-5 border border-slate-200">
            <div class="flex items-center justify-between">
              <div class="font-extrabold">Acompanhe seu treino</div>
              <span class="text-xs font-semibold text-slate-500">Extras</span>
            </div>
            <div class="mt-3 grid grid-cols-3 gap-3">
              <div class="rounded-2xl bg-slate-50 border border-slate-200 p-3">
                <div class="text-xs text-slate-500">Meta</div>
                <div class="font-extrabold">Força</div>
              </div>
              <div class="rounded-2xl bg-slate-50 border border-slate-200 p-3">
                <div class="text-xs text-slate-500">Foco</div>
                <div class="font-extrabold">Mobilidade</div>
              </div>
              <div class="rounded-2xl bg-slate-50 border border-slate-200 p-3">
                <div class="text-xs text-slate-500">Nível</div>
                <div class="font-extrabold">Todos</div>
              </div>
            </div>
            <div class="mt-4 flex items-center gap-3">
              <div class="grow">
                <div class="h-2 rounded-full bg-slate-100 overflow-hidden">
                  <div class="h-full w-2/3 bg-gradient-to-r from-blue-600 to-emerald-500"></div>
                </div>
                <div class="mt-2 text-xs text-slate-500">Progresso fictício: 66%</div>
              </div>
              <button id="btnScrollProducts" class="rounded-xl bg-slate-900 text-white px-4 py-2 text-sm font-semibold hover:bg-slate-800 focus-ring">Começar</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Products -->
  <main id="produtos" class="mx-auto max-w-7xl px-4 py-12">
    <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6">
      <div>
        <h2 class="text-3xl font-black tracking-tight">Produtos</h2>
        <p class="mt-2 text-slate-600">Pesquise, filtre e adicione ao carrinho. Tudo aqui é <span class="font-semibold">fictício</span>, mas a experiência é real.</p>
      </div>

      <div class="grid sm:grid-cols-3 gap-3 w-full md:max-w-2xl">
        <label class="block">
          <span class="sr-only">Buscar</span>
          <div class="relative">
            <svg xmlns="http://www.w3.org/2000/svg" class="size-5 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input id="searchInput" class="w-full rounded-xl border border-slate-200 bg-white px-10 py-2.5 text-sm focus-ring" placeholder="Buscar por nome, categoria ou tag..." />
          </div>
        </label>

        <label class="block">
          <span class="sr-only">Categoria</span>
          <select id="categorySelect" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring">
            <option value="all">Todas as categorias</option>
          </select>
        </label>

        <label class="block">
          <span class="sr-only">Ordenação</span>
          <select id="sortSelect" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring">
            <option value="featured">Relevância</option>
            <option value="price-asc">Preço: menor → maior</option>
            <option value="price-desc">Preço: maior → menor</option>
            <option value="rating-desc">Avaliação</option>
            <option value="name-asc">Nome (A-Z)</option>
          </select>
        </label>
      </div>
    </div>

    <!-- Quick filters -->
    <div class="mt-6 flex flex-wrap gap-2">
      <button class="chip" data-chip="novidade"></button>
      <button class="chip" data-chip="maisvendido"></button>
      <button class="chip" data-chip="fretegratis"></button>
      <button class="chip" data-chip="kit"></button>
      <button class="chip" data-chip="compacto"></button>
      <button class="chip" data-chip="recuperacao"></button>
    </div>

    <div class="mt-6 flex items-center justify-between gap-3">
      <div class="text-sm text-slate-600">
        <span id="resultsCount" class="font-semibold text-slate-900">0</span> produtos encontrados
      </div>
      <div class="flex items-center gap-2">
        <button id="btnClearFilters" class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-3 py-2 text-sm font-semibold focus-ring">Limpar filtros</button>
      </div>
    </div>

    <div id="productGrid" class="mt-6 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>

    <div id="emptyState" class="hidden mt-10 rounded-3xl border border-dashed border-slate-300 bg-white p-8 text-center">
      <div class="mx-auto max-w-md">
        <div class="text-xl font-extrabold">Nada por aqui…</div>
        <p class="mt-2 text-slate-600">Tente ajustar a busca ou remover alguns filtros.</p>
      </div>
    </div>
  </main>

  <!-- Offers -->
  <section id="ofertas" class="bg-white border-y border-slate-200">
    <div class="mx-auto max-w-7xl px-4 py-12">
      <div class="flex items-end justify-between gap-6">
        <div>
          <h2 class="text-3xl font-black tracking-tight">Ofertas (fictícias)</h2>
          <p class="mt-2 text-slate-600">Cupons e promoções para testar o carrinho.</p>
        </div>
        <button id="btnShowCoupons" class="rounded-xl bg-slate-900 text-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-800 focus-ring">Ver cupons</button>
      </div>

      <div class="mt-6 grid md:grid-cols-3 gap-4">
        <div class="rounded-3xl border border-slate-200 bg-gradient-to-br from-blue-50 to-white p-6">
          <div class="text-xs font-semibold text-blue-700">Cupom</div>
          <div class="mt-1 text-2xl font-black tracking-tight">ATLAS10</div>
          <p class="mt-2 text-slate-600">10% OFF em qualquer pedido (máx. R$ 50).</p>
          <button class="mt-4 btnCopyCoupon rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-50 focus-ring" data-coupon="ATLAS10">Copiar</button>
        </div>
        <div class="rounded-3xl border border-slate-200 bg-gradient-to-br from-emerald-50 to-white p-6">
          <div class="text-xs font-semibold text-emerald-700">Cupom</div>
          <div class="mt-1 text-2xl font-black tracking-tight">FRETEGRATIS</div>
          <p class="mt-2 text-slate-600">Zera o frete fictício (para testar o total).</p>
          <button class="mt-4 btnCopyCoupon rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-50 focus-ring" data-coupon="FRETEGRATIS">Copiar</button>
        </div>
        <div class="rounded-3xl border border-slate-200 bg-gradient-to-br from-fuchsia-50 to-white p-6">
          <div class="text-xs font-semibold text-fuchsia-700">Combo</div>
          <div class="mt-1 text-2xl font-black tracking-tight">KITS</div>
          <p class="mt-2 text-slate-600">Ganhe 15% OFF em produtos com tag <span class="font-semibold">kit</span>.</p>
          <button class="mt-4 btnCopyCoupon rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-50 focus-ring" data-coupon="KITS">Copiar</button>
        </div>
      </div>

      <div class="mt-8 rounded-3xl border border-slate-200 bg-slate-50 p-6">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
          <div>
            <div class="font-extrabold">Dica</div>
            <p class="text-slate-600">Adicione alguns itens ao carrinho e aplique um cupom para ver os cálculos atualizando em tempo real.</p>
          </div>
          <div class="flex items-center gap-2">
            <button id="btnAddBundle" class="rounded-xl bg-slate-900 text-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-800 focus-ring">Adicionar kit rápido</button>
            <button id="btnResetDemo" class="rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-50 focus-ring">Reset demo</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- About -->
  <section id="sobre" class="mx-auto max-w-7xl px-4 py-12">
    <div class="grid md:grid-cols-2 gap-8 items-start">
      <div>
        <h2 class="text-3xl font-black tracking-tight">Sobre a AtlasFit</h2>
        <p class="mt-3 text-slate-600">A AtlasFit é uma loja <span class="font-semibold">fictícia</span> criada para demonstração. O site inclui catálogo, filtros, carrinho, cupons e um checkout simulado — perfeito para protótipos, estudos e portfólio.</p>

        <div class="mt-6 grid sm:grid-cols-2 gap-4">
          <div class="rounded-3xl border border-slate-200 bg-white p-5">
            <div class="font-extrabold">Entrega</div>
            <p class="mt-2 text-sm text-slate-600">Cálculo de frete fictício baseado no subtotal.</p>
          </div>
          <div class="rounded-3xl border border-slate-200 bg-white p-5">
            <div class="font-extrabold">Pagamentos</div>
            <p class="mt-2 text-sm text-slate-600">Checkout simulado com validações básicas.</p>
          </div>
          <div class="rounded-3xl border border-slate-200 bg-white p-5">
            <div class="font-extrabold">Carrinho</div>
            <p class="mt-2 text-sm text-slate-600">Persistência em localStorage e edição de quantidades.</p>
          </div>
          <div class="rounded-3xl border border-slate-200 bg-white p-5">
            <div class="font-extrabold">Acessibilidade</div>
            <p class="mt-2 text-sm text-slate-600">Modais com foco, labels e navegação por teclado.</p>
          </div>
        </div>
      </div>

      <div class="rounded-3xl border border-slate-200 bg-white p-6">
        <div class="flex items-center justify-between">
          <div>
            <div class="font-extrabold">Avaliações (demo)</div>
            <div class="text-sm text-slate-600">O que clientes fictícios estão dizendo</div>
          </div>
          <div class="text-sm font-semibold text-slate-900">4,8/5</div>
        </div>

        <div class="mt-4 space-y-4">
          <figure class="rounded-2xl bg-slate-50 border border-slate-200 p-4">
            <blockquote class="text-sm text-slate-700">“Entrega rápida e os halteres ajustáveis mudaram meu treino em casa.”</blockquote>
            <figcaption class="mt-2 text-xs text-slate-500">— Camila, SP</figcaption>
          </figure>
          <figure class="rounded-2xl bg-slate-50 border border-slate-200 p-4">
            <blockquote class="text-sm text-slate-700">“O kit de elásticos é compacto e resistente. Ótimo custo-benefício.”</blockquote>
            <figcaption class="mt-2 text-xs text-slate-500">— Bruno, MG</figcaption>
          </figure>
          <figure class="rounded-2xl bg-slate-50 border border-slate-200 p-4">
            <blockquote class="text-sm text-slate-700">“A experiência do site é suave e o carrinho é bem completo.”</blockquote>
            <figcaption class="mt-2 text-xs text-slate-500">— Pri, RJ</figcaption>
          </figure>
        </div>

        <div class="mt-6 rounded-2xl border border-slate-200 bg-white p-4">
          <div class="flex items-center justify-between gap-3">
            <div>
              <div class="font-extrabold">Newsletter (demo)</div>
              <div class="text-sm text-slate-600">Receba ofertas fictícias e lançamentos</div>
            </div>
            <div class="text-xs font-semibold text-slate-500">Sem spam</div>
          </div>
          <div class="mt-3 flex flex-col sm:flex-row gap-2">
            <input id="newsletterEmail" type="email" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring" placeholder="seuemail@exemplo.com" />
            <button id="btnNewsletter" class="rounded-xl bg-slate-900 text-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-800 focus-ring">Assinar</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Contact / Footer -->
  <footer id="contato" class="bg-slate-900 text-slate-100">
    <div class="mx-auto max-w-7xl px-4 py-12">
      <div class="grid md:grid-cols-3 gap-8">
        <div>
          <div class="flex items-center gap-2">
            <div class="size-10 rounded-xl bg-white/10 grid place-items-center font-black">AF</div>
            <div>
              <div class="font-extrabold">AtlasFit</div>
              <div class="text-xs text-slate-300">e-commerce fitness (fictício)</div>
            </div>
          </div>
          <p class="mt-4 text-slate-300 text-sm">Projeto demonstrativo. Nenhuma compra é realizada e nenhum pagamento é processado.</p>
        </div>

        <div>
          <div class="font-extrabold">Contato</div>
          <div class="mt-3 space-y-2 text-sm text-slate-300">
            <div class="flex items-center gap-2">
              <span class="inline-block size-2 rounded-full bg-emerald-400"></span>
              suporte@atlasfit.demo
            </div>
            <div>Seg–Sex: 9h às 18h</div>
            <div>São Paulo • Brasil</div>
          </div>
        </div>

        <div>
          <div class="font-extrabold">Atalhos</div>
          <div class="mt-3 grid grid-cols-2 gap-2 text-sm">
            <a class="rounded-xl bg-white/5 hover:bg-white/10 px-3 py-2" href="#produtos">Produtos</a>
            <a class="rounded-xl bg-white/5 hover:bg-white/10 px-3 py-2" href="#ofertas">Ofertas</a>
            <button id="btnOpenCartFooter" class="rounded-xl bg-white/5 hover:bg-white/10 px-3 py-2 text-left">Carrinho</button>
            <button id="btnScrollTop" class="rounded-xl bg-white/5 hover:bg-white/10 px-3 py-2 text-left">Voltar ao topo</button>
          </div>
        </div>
      </div>

      <div class="mt-10 pt-6 border-t border-white/10 flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 text-xs text-slate-300">
        <div>© <span id="year"></span> AtlasFit. Demo de e-commerce fictício.</div>
        <div class="flex items-center gap-2">
          <span class="px-2 py-1 rounded-lg bg-white/10">Privacidade</span>
          <span class="px-2 py-1 rounded-lg bg-white/10">Termos</span>
          <span class="px-2 py-1 rounded-lg bg-white/10">Cookies</span>
        </div>
      </div>
    </div>
  </footer>

  <!-- Product Modal -->
  <div id="productModal" class="fixed inset-0 z-50 hidden" aria-hidden="true">
    <div id="productModalOverlay" class="absolute inset-0 bg-slate-900/60"></div>
    <div class="relative h-full w-full grid place-items-center p-4">
      <div class="w-full max-w-3xl rounded-3xl bg-white border border-slate-200 shadow-2xl overflow-hidden" role="dialog" aria-modal="true" aria-label="Detalhes do produto">
        <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200">
          <div>
            <div id="modalTitle" class="font-extrabold text-lg">Produto</div>
            <div id="modalSubtitle" class="text-sm text-slate-500">Categoria • tags</div>
          </div>
          <button id="btnCloseProductModal" class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-3 py-2 text-sm font-semibold focus-ring" aria-label="Fechar">Fechar</button>
        </div>
        <div class="grid md:grid-cols-2 gap-0">
          <div class="bg-slate-50 border-b md:border-b-0 md:border-r border-slate-200">
            <img id="modalImage" alt="" class="w-full h-72 md:h-full object-cover" />
          </div>
          <div class="p-5">
            <div class="flex items-center justify-between">
              <div id="modalPrice" class="text-2xl font-black">R$ 0,00</div>
              <div class="text-xs font-semibold text-slate-600">Estoque: <span id="modalStock" class="text-slate-900">0</span></div>
            </div>
            <div id="modalRating" class="mt-2 text-sm text-slate-600">★★★★☆ (0)</div>
            <p id="modalDesc" class="mt-4 text-slate-700"></p>

            <div class="mt-5 grid grid-cols-2 gap-3">
              <div class="rounded-2xl border border-slate-200 bg-white p-4">
                <div class="text-xs text-slate-500">Ideal para</div>
                <div id="modalUse" class="mt-1 font-extrabold">—</div>
              </div>
              <div class="rounded-2xl border border-slate-200 bg-white p-4">
                <div class="text-xs text-slate-500">Destaque</div>
                <div id="modalHighlight" class="mt-1 font-extrabold">—</div>
              </div>
            </div>

            <div class="mt-5 flex flex-col sm:flex-row gap-3">
              <button id="btnModalAdd" class="rounded-xl bg-slate-900 text-white px-5 py-3 font-bold hover:bg-slate-800 focus-ring w-full">Adicionar ao carrinho</button>
              <button id="btnModalBuyNow" class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-5 py-3 font-bold focus-ring w-full">Comprar agora</button>
            </div>

            <div class="mt-4 text-xs text-slate-500">* Imagens ilustrativas via Unsplash. Preços e políticas são fictícios.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Coupons Modal -->
  <div id="couponsModal" class="fixed inset-0 z-50 hidden" aria-hidden="true">
    <div id="couponsOverlay" class="absolute inset-0 bg-slate-900/60"></div>
    <div class="relative h-full w-full grid place-items-center p-4">
      <div class="w-full max-w-xl rounded-3xl bg-white border border-slate-200 shadow-2xl overflow-hidden" role="dialog" aria-modal="true" aria-label="Cupons">
        <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200">
          <div>
            <div class="font-extrabold text-lg">Cupons disponíveis</div>
            <div class="text-sm text-slate-500">Copie e aplique no carrinho</div>
          </div>
          <button id="btnCloseCoupons" class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-3 py-2 text-sm font-semibold focus-ring">Fechar</button>
        </div>
        <div class="p-5">
          <div class="grid gap-3">
            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4 flex items-center justify-between gap-3">
              <div>
                <div class="font-extrabold">ATLAS10</div>
                <div class="text-sm text-slate-600">10% OFF em qualquer pedido (máx. R$ 50)</div>
              </div>
              <button class="btnCopyCoupon rounded-xl bg-slate-900 text-white px-4 py-2 text-sm font-semibold hover:bg-slate-800 focus-ring" data-coupon="ATLAS10">Copiar</button>
            </div>
            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4 flex items-center justify-between gap-3">
              <div>
                <div class="font-extrabold">FRETEGRATIS</div>
                <div class="text-sm text-slate-600">Zera o frete fictício</div>
              </div>
              <button class="btnCopyCoupon rounded-xl bg-slate-900 text-white px-4 py-2 text-sm font-semibold hover:bg-slate-800 focus-ring" data-coupon="FRETEGRATIS">Copiar</button>
            </div>
            <div class="rounded-2xl border border-slate-200 bg-slate-50 p-4 flex items-center justify-between gap-3">
              <div>
                <div class="font-extrabold">KITS</div>
                <div class="text-sm text-slate-600">15% OFF em produtos com tag <span class="font-semibold">kit</span></div>
              </div>
              <button class="btnCopyCoupon rounded-xl bg-slate-900 text-white px-4 py-2 text-sm font-semibold hover:bg-slate-800 focus-ring" data-coupon="KITS">Copiar</button>
            </div>
          </div>
          <div class="mt-4 text-xs text-slate-500">Dica: clique em “Abrir carrinho” e cole o cupom no campo.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Cart Drawer -->
  <aside id="cartDrawer" class="fixed inset-y-0 right-0 z-50 w-full sm:w-[420px] translate-x-full transition-transform duration-200 ease-out" aria-hidden="true">
    <div class="absolute inset-0 bg-slate-900/50 opacity-0 transition-opacity duration-200" id="cartBackdrop"></div>
    <div class="relative h-full bg-white border-l border-slate-200 shadow-2xl flex flex-col">
      <div class="px-5 py-4 border-b border-slate-200 flex items-center justify-between gap-3">
        <div>
          <div class="font-extrabold text-lg">Seu carrinho</div>
          <div class="text-sm text-slate-500"><span id="cartItemsCount">0</span> itens</div>
        </div>
        <button id="btnCloseCart" class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-3 py-2 text-sm font-semibold focus-ring" aria-label="Fechar carrinho">Fechar</button>
      </div>

      <div class="p-4 border-b border-slate-200">
        <label class="block">
          <span class="text-xs font-semibold text-slate-600">Cupom</span>
          <div class="mt-1 flex gap-2">
            <input id="couponInput" class="w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring" placeholder="Ex.: ATLAS10" />
            <button id="btnApplyCoupon" class="rounded-xl bg-slate-900 text-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-800 focus-ring">Aplicar</button>
          </div>
          <div id="couponHint" class="mt-2 text-xs text-slate-500">Cupons: <span class="font-semibold">ATLAS10</span>, <span class="font-semibold">FRETEGRATIS</span>, <span class="font-semibold">KITS</span></div>
        </label>
      </div>

      <div id="cartList" class="flex-1 overflow-auto no-scrollbar p-4 space-y-3"></div>

      <div class="border-t border-slate-200 p-4">
        <div class="space-y-2 text-sm">
          <div class="flex items-center justify-between"><span class="text-slate-600">Subtotal</span><span id="subtotal" class="font-semibold">R$ 0,00</span></div>
          <div class="flex items-center justify-between"><span class="text-slate-600">Frete (fictício)</span><span id="shipping" class="font-semibold">R$ 0,00</span></div>
          <div class="flex items-center justify-between"><span class="text-slate-600">Desconto</span><span id="discount" class="font-semibold text-emerald-700">- R$ 0,00</span></div>
          <div class="h-px bg-slate-200 my-2"></div>
          <div class="flex items-center justify-between text-base"><span class="font-extrabold">Total</span><span id="total" class="font-black">R$ 0,00</span></div>
        </div>
        <div class="mt-4 grid gap-2">
          <button id="btnCheckout" class="rounded-xl bg-slate-900 text-white px-4 py-3 text-sm font-bold hover:bg-slate-800 focus-ring">Finalizar compra (demo)</button>
          <button id="btnContinue" class="rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm font-semibold hover:bg-slate-50 focus-ring">Continuar comprando</button>
          <button id="btnClearCart" class="rounded-xl border border-slate-200 bg-white px-4 py-3 text-sm font-semibold hover:bg-slate-50 focus-ring">Esvaziar carrinho</button>
        </div>
        <div class="mt-3 text-xs text-slate-500">Ao finalizar, você verá um formulário de checkout simulado (sem pagamento real).</div>
      </div>
    </div>
  </aside>

  <!-- Checkout Modal -->
  <div id="checkoutModal" class="fixed inset-0 z-50 hidden" aria-hidden="true">
    <div id="checkoutOverlay" class="absolute inset-0 bg-slate-900/60"></div>
    <div class="relative h-full w-full grid place-items-center p-4">
      <div class="w-full max-w-3xl rounded-3xl bg-white border border-slate-200 shadow-2xl overflow-hidden" role="dialog" aria-modal="true" aria-label="Checkout">
        <div class="flex items-center justify-between px-5 py-4 border-b border-slate-200">
          <div>
            <div class="font-extrabold text-lg">Checkout (demo)</div>
            <div class="text-sm text-slate-500">Preencha para simular o pedido</div>
          </div>
          <button id="btnCloseCheckout" class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-3 py-2 text-sm font-semibold focus-ring">Fechar</button>
        </div>

        <div class="grid md:grid-cols-5 gap-0">
          <div class="md:col-span-3 p-5">
            <form id="checkoutForm" class="space-y-4">
              <div class="grid sm:grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-xs font-semibold text-slate-600">Nome</span>
                  <input name="name" required class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring" placeholder="Seu nome" />
                </label>
                <label class="block">
                  <span class="text-xs font-semibold text-slate-600">E-mail</span>
                  <input name="email" type="email" required class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring" placeholder="voce@exemplo.com" />
                </label>
              </div>
              <div class="grid sm:grid-cols-3 gap-3">
                <label class="block sm:col-span-2">
                  <span class="text-xs font-semibold text-slate-600">Endereço</span>
                  <input name="address" required class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring" placeholder="Rua, número" />
                </label>
                <label class="block">
                  <span class="text-xs font-semibold text-slate-600">CEP</span>
                  <input name="zip" required inputmode="numeric" class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring" placeholder="00000-000" />
                </label>
              </div>
              <div class="grid sm:grid-cols-2 gap-3">
                <label class="block">
                  <span class="text-xs font-semibold text-slate-600">Forma de pagamento</span>
                  <select name="payment" class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring">
                    <option>Cartão (simulado)</option>
                    <option>PIX (simulado)</option>
                    <option>Boleto (simulado)</option>
                  </select>
                </label>
                <label class="block">
                  <span class="text-xs font-semibold text-slate-600">Parcelas</span>
                  <select name="installments" class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring">
                    <option value="1">1x</option>
                    <option value="2">2x</option>
                    <option value="3">3x</option>
                    <option value="6">6x</option>
                    <option value="12">12x</option>
                  </select>
                </label>
              </div>

              <label class="block">
                <span class="text-xs font-semibold text-slate-600">Observações</span>
                <textarea name="notes" rows="3" class="mt-1 w-full rounded-xl border border-slate-200 bg-white px-3 py-2.5 text-sm focus-ring" placeholder="Ex.: deixar na portaria"></textarea>
              </label>

              <div class="pt-2 flex flex-col sm:flex-row gap-3">
                <button class="rounded-xl bg-slate-900 text-white px-5 py-3 font-bold hover:bg-slate-800 focus-ring w-full" type="submit">Confirmar pedido (demo)</button>
                <button id="btnBackToCart" class="rounded-xl border border-slate-200 bg-white px-5 py-3 font-bold hover:bg-slate-50 focus-ring w-full" type="button">Voltar ao carrinho</button>
              </div>

              <div class="text-xs text-slate-500">Ao confirmar, será gerado um número de pedido fictício. Nenhum dado é enviado para servidor.</div>
            </form>
          </div>

          <div class="md:col-span-2 bg-slate-50 border-t md:border-t-0 md:border-l border-slate-200 p-5">
            <div class="font-extrabold">Resumo</div>
            <div class="mt-2 text-sm text-slate-600">Confira antes de confirmar</div>

            <div id="checkoutSummary" class="mt-4 space-y-3"></div>

            <div class="mt-4 rounded-2xl border border-slate-200 bg-white p-4 text-sm">
              <div class="flex items-center justify-between"><span class="text-slate-600">Total</span><span id="checkoutTotal" class="font-black">R$ 0,00</span></div>
              <div class="mt-2 text-xs text-slate-500">* Totais baseados no carrinho atual.</div>
            </div>

            <div class="mt-4 rounded-2xl border border-slate-200 bg-white p-4 text-xs text-slate-500">
              <div class="font-semibold text-slate-700">Segurança (demo)</div>
              <div class="mt-1">Este checkout é apenas uma simulação. Não use dados reais sensíveis.</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toasts -->
  <div id="toastArea" class="fixed bottom-4 right-4 z-[60] space-y-2"></div>

  <script>
    // -----------------------------
    // Demo store data
    // -----------------------------
    const PRODUCTS = [
      {
        id: 'p1',
        name: 'Halter Ajustável 2–24 kg (par)',
        category: 'Pesos',
        price: 899.90,
        rating: 4.9,
        reviews: 312,
        stock: 18,
        tags: ['maisvendido', 'compacto'],
        use: 'Treino de força',
        highlight: 'Variação rápida de carga',
        desc: 'Substitui vários pares de halteres com ajustes rápidos. Ideal para treinos em casa com pouco espaço.',
        image: 'https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p2',
        name: 'Kettlebell Revestido 16 kg',
        category: 'Pesos',
        price: 219.90,
        rating: 4.7,
        reviews: 148,
        stock: 34,
        tags: ['novidade'],
        use: 'Condicionamento e potência',
        highlight: 'Pegada confortável',
        desc: 'Kettlebell com revestimento para proteger o piso. Ótimo para swings, agachamentos e complexos.',
        image: 'https://images.unsplash.com/photo-1590487988256-9ed24133863e?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p3',
        name: 'Anilhas Olímpicas Bumper 10 kg (par)',
        category: 'Pesos',
        price: 289.90,
        rating: 4.6,
        reviews: 77,
        stock: 22,
        tags: ['fretegratis'],
        use: 'Levantamento olímpico',
        highlight: 'Borracha de alta durabilidade',
        desc: 'Anilhas bumper para treinos com barra. Absorvem impacto e reduzem ruído ao soltar no chão.',
        image: 'https://images.unsplash.com/photo-1599058917765-2c2a4c1b3c6c?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p4',
        name: 'Corda de Pular Speed com Rolamento',
        category: 'Cardio',
        price: 59.90,
        rating: 4.8,
        reviews: 401,
        stock: 120,
        tags: ['maisvendido', 'compacto'],
        use: 'HIIT e condicionamento',
        highlight: 'Giro suave e rápido',
        desc: 'Corda leve com rolamentos para alta velocidade. Ajuste de comprimento e pegada antiderrapante.',
        image: 'https://images.unsplash.com/photo-1517964603305-11c0f6f66012?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p5',
        name: 'Tapete de Yoga Pro 6mm Antiderrapante',
        category: 'Yoga & Pilates',
        price: 119.90,
        rating: 4.7,
        reviews: 256,
        stock: 65,
        tags: ['fretegratis'],
        use: 'Yoga, pilates e alongamento',
        highlight: 'Aderência + conforto',
        desc: 'Tapete com ótima aderência e amortecimento. Textura firme para estabilidade em posturas.',
        image: 'https://images.unsplash.com/photo-1554344058-239ef3e4b45d?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p6',
        name: 'Rolo de Liberação Miofascial (Foam Roller)',
        category: 'Recuperação',
        price: 89.90,
        rating: 4.8,
        reviews: 198,
        stock: 40,
        tags: ['recuperacao', 'maisvendido'],
        use: 'Mobilidade e recuperação',
        highlight: 'Textura em alto relevo',
        desc: 'Alivia tensões e ajuda na recuperação muscular. Ideal pós-treino e para melhorar amplitude de movimento.',
        image: 'https://images.unsplash.com/photo-1590556409324-aa1d726e5c3c?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p7',
        name: 'Bola Suíça 65cm + Bomba',
        category: 'Acessórios',
        price: 109.90,
        rating: 4.5,
        reviews: 92,
        stock: 28,
        tags: ['compacto'],
        use: 'Core e estabilidade',
        highlight: 'Anti-estouro',
        desc: 'Bola suíça para exercícios de core, mobilidade e estabilidade. Inclui bomba para enchimento.',
        image: 'https://images.unsplash.com/photo-1576678927484-cc907957088c?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p8',
        name: 'Kit Elásticos de Resistência (5 níveis)',
        category: 'Elásticos',
        price: 79.90,
        rating: 4.9,
        reviews: 520,
        stock: 150,
        tags: ['kit', 'maisvendido', 'compacto'],
        use: 'Força e reabilitação',
        highlight: '5 níveis de resistência',
        desc: 'Conjunto com 5 faixas e bolsa. Perfeito para ativação, treinos completos e mobilidade.',
        image: 'https://images.unsplash.com/photo-1594381898411-846e7d193883?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p9',
        name: 'Mini Band Tecido (3 níveis)',
        category: 'Elásticos',
        price: 69.90,
        rating: 4.7,
        reviews: 214,
        stock: 88,
        tags: ['kit', 'compacto'],
        use: 'Glúteos e estabilidade',
        highlight: 'Tecido que não enrola',
        desc: 'Mini bands em tecido para exercícios de glúteos, pernas e estabilizadores. Mais conforto e durabilidade.',
        image: 'https://images.unsplash.com/photo-1599058918144-1ffabb6ab9a0?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p10',
        name: 'Banco Regulável (inclinação/declinação)',
        category: 'Equipamentos',
        price: 649.90,
        rating: 4.6,
        reviews: 64,
        stock: 12,
        tags: ['fretegratis'],
        use: 'Treino completo com pesos',
        highlight: 'Estrutura reforçada',
        desc: 'Banco robusto com ajustes de ângulo para supino, desenvolvimento, remadas e mais. Base estável e confortável.',
        image: 'https://images.unsplash.com/photo-1583454110558-0f9fd3c2bb77?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p11',
        name: 'Barra de Porta para Pull-up',
        category: 'Equipamentos',
        price: 139.90,
        rating: 4.4,
        reviews: 187,
        stock: 55,
        tags: ['compacto', 'maisvendido'],
        use: 'Costas e braços',
        highlight: 'Instalação sem furar*',
        desc: 'Barra de porta para pull-ups e exercícios com suspensão. *Em superfícies compatíveis (demo).',
        image: 'https://images.unsplash.com/photo-1517963879433-6ad2b056d712?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p12',
        name: 'Caneleira 2 kg (par)',
        category: 'Pesos',
        price: 79.90,
        rating: 4.6,
        reviews: 133,
        stock: 72,
        tags: ['compacto'],
        use: 'Pernas e glúteos',
        highlight: 'Ajuste com velcro',
        desc: 'Caneleiras confortáveis para treinos de perna e exercícios aeróbicos. Distribuição de peso equilibrada.',
        image: 'https://images.unsplash.com/photo-1599058945522-28d584b1b5f4?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p13',
        name: 'Step Ajustável 3 níveis',
        category: 'Cardio',
        price: 169.90,
        rating: 4.5,
        reviews: 98,
        stock: 19,
        tags: ['novidade'],
        use: 'Aulas e cardio',
        highlight: 'Altura ajustável',
        desc: 'Step com superfície antiderrapante para treinos de cardio e resistência. Ajuste rápido de altura.',
        image: 'https://images.unsplash.com/photo-1517832207067-4db24a2ae47c?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p14',
        name: 'Squeeze Inox 750ml',
        category: 'Acessórios',
        price: 89.90,
        rating: 4.8,
        reviews: 341,
        stock: 200,
        tags: ['compacto', 'maisvendido'],
        use: 'Hidratação',
        highlight: 'Mantém temperatura',
        desc: 'Garrafa térmica em inox para água e bebidas. Ideal para treinos longos e dia a dia.',
        image: 'https://images.unsplash.com/photo-1526401485004-2fda9f6d4f0f?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p15',
        name: 'Luvas de Treino Grip',
        category: 'Acessórios',
        price: 69.90,
        rating: 4.3,
        reviews: 121,
        stock: 90,
        tags: ['novidade'],
        use: 'Treino de puxada',
        highlight: 'Antiderrapante',
        desc: 'Luvas leves para melhorar a pegada em barras e halteres. Confortáveis e respiráveis.',
        image: 'https://images.unsplash.com/photo-1594381898411-0f0c2e5d9f96?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p16',
        name: 'Cinto de Levantamento (Lombar)',
        category: 'Acessórios',
        price: 119.90,
        rating: 4.6,
        reviews: 84,
        stock: 42,
        tags: ['fretegratis'],
        use: 'Agachamento e terra',
        highlight: 'Estabilidade extra',
        desc: 'Cinto para suporte do core e lombar em levantamentos pesados. Ajuste firme e confortável.',
        image: 'https://images.unsplash.com/photo-1593079831268-3381b0db4a77?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p17',
        name: 'Colchonete Fitness 12mm',
        category: 'Yoga & Pilates',
        price: 99.90,
        rating: 4.7,
        reviews: 173,
        stock: 60,
        tags: ['maisvendido'],
        use: 'Abdômen e alongamento',
        highlight: 'Espessura extra',
        desc: 'Colchonete confortável para exercícios no solo. Boa densidade para proteger joelhos e coluna.',
        image: 'https://images.unsplash.com/photo-1605296867304-46d5465a13f1?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p18',
        name: 'Massageador Percussivo Compacto',
        category: 'Recuperação',
        price: 399.90,
        rating: 4.8,
        reviews: 210,
        stock: 25,
        tags: ['recuperacao', 'compacto'],
        use: 'Recuperação muscular',
        highlight: '5 intensidades',
        desc: 'Massageador percussivo para aliviar tensão e acelerar recuperação. Acompanha ponteiras (demo).',
        image: 'https://images.unsplash.com/photo-1616325629936-99d5b0b9c19a?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p19',
        name: 'Roda Abdominal (Ab Wheel) com Tapete',
        category: 'Acessórios',
        price: 79.90,
        rating: 4.5,
        reviews: 266,
        stock: 110,
        tags: ['maisvendido', 'compacto'],
        use: 'Core',
        highlight: 'Pegada anatômica',
        desc: 'Roda abdominal para treinos de core e estabilidade. Inclui tapete para joelhos.',
        image: 'https://images.unsplash.com/photo-1599058917212-d750089bc07a?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p20',
        name: 'Kit Home Gym Essencial (tapete + elásticos + corda)',
        category: 'Kits',
        price: 189.90,
        rating: 4.9,
        reviews: 144,
        stock: 35,
        tags: ['kit', 'maisvendido', 'fretegratis'],
        use: 'Treinos completos',
        highlight: 'Tudo em 1',
        desc: 'Kit pensado para começar: tapete, elásticos de resistência e corda speed. Prático para qualquer lugar.',
        image: 'https://images.unsplash.com/photo-1558611848-73f7eb4001a1?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p21',
        name: 'Corda Naval 9m',
        category: 'Cardio',
        price: 279.90,
        rating: 4.6,
        reviews: 58,
        stock: 14,
        tags: ['fretegratis'],
        use: 'Treino metabólico',
        highlight: 'Alta resistência',
        desc: 'Corda naval para treinos intensos e condicionamento. Excelente para circuitos e potência.',
        image: 'https://images.unsplash.com/photo-1517637633369-e05c9cf0f4f6?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p22',
        name: 'Bola de Massagem (Lacrosse)',
        category: 'Recuperação',
        price: 34.90,
        rating: 4.7,
        reviews: 190,
        stock: 260,
        tags: ['recuperacao', 'compacto'],
        use: 'Pontos de tensão',
        highlight: 'Firme e pequena',
        desc: 'Bola firme para liberação miofascial em pontos específicos (ombros, pés, glúteos).',
        image: 'https://images.unsplash.com/photo-1605296867304-5c1a6c08df72?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p23',
        name: 'Caneleira 5 kg (par)',
        category: 'Pesos',
        price: 149.90,
        rating: 4.4,
        reviews: 81,
        stock: 30,
        tags: ['novidade'],
        use: 'Pernas e glúteos',
        highlight: 'Carga maior',
        desc: 'Para quem quer intensificar treinos de perna. Ajuste seguro e confortável.',
        image: 'https://images.unsplash.com/photo-1599058945522-8b1c1bd1d8f2?auto=format&fit=crop&w=1200&q=70'
      },
      {
        id: 'p24',
        name: 'TRX Fitas de Suspensão (compatível)',
        category: 'Equipamentos',
        price: 229.90,
        rating: 4.7,
        reviews: 112,
        stock: 26,
        tags: ['compacto', 'fretegratis'],
        use: 'Treino funcional',
        highlight: 'Treino full-body',
        desc: 'Fitas de suspensão para exercícios com peso corporal: puxadas, agachamentos, pranchas e mais.',
        image: 'https://images.unsplash.com/photo-1526401485004-2a932a0b5011?auto=format&fit=crop&w=1200&q=70'
      }
    ];

    const CHIP_LABELS = {
      novidade: 'Novidades',
      maisvendido: 'Mais vendidos',
      fretegratis: 'Frete grátis*',
      kit: 'Kits',
      compacto: 'Compactos',
      recuperacao: 'Recuperação'
    };

    // -----------------------------
    // State
    // -----------------------------
    const LS_KEYS = {
      cart: 'atlasfit_cart_v1',
      coupon: 'atlasfit_coupon_v1',
      chips: 'atlasfit_chips_v1',
      search: 'atlasfit_search_v1',
      category: 'atlasfit_category_v1',
      sort: 'atlasfit_sort_v1'
    };

    /** @type {Record<string, {id:string, qty:number}>} */
    let cart = {};
    let appliedCoupon = '';

    const filters = {
      search: '',
      category: 'all',
      sort: 'featured',
      chips: new Set()
    };

    let currentModalProductId = null;

    // -----------------------------
    // Helpers
    // -----------------------------
    const BRL = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });

    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function $(id){ return document.getElementById(id); }

    function escapeHtml(str){
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }

    function toStars(rating){
      const full = Math.floor(rating);
      const half = rating - full >= 0.5 ? 1 : 0;
      const empty = 5 - full - half;
      return '★'.repeat(full) + (half ? '⯪' : '') + '☆'.repeat(empty);
    }

    function toast(message, type='info'){
      const area = $('toastArea');
      const colors = {
        info: 'bg-slate-900 text-white',
        ok: 'bg-emerald-600 text-white',
        warn: 'bg-amber-500 text-slate-900',
        err: 'bg-rose-600 text-white'
      };
      const el = document.createElement('div');
      el.className = `rounded-2xl shadow-lg px-4 py-3 text-sm font-semibold ${colors[type] || colors.info}`;
      el.textContent = message;
      area.appendChild(el);
      requestAnimationFrame(() => {
        el.style.transition = 'opacity 250ms ease, transform 250ms ease';
        el.style.opacity = '1';
        el.style.transform = 'translateY(0)';
      });
      setTimeout(() => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(8px)';
        setTimeout(() => el.remove(), 260);
      }, 2600);
    }

    function loadState(){
      try{
        cart = JSON.parse(localStorage.getItem(LS_KEYS.cart) || '{}') || {};
      }catch{ cart = {}; }
      appliedCoupon = (localStorage.getItem(LS_KEYS.coupon) || '').trim().toUpperCase();

      // Filters (optional)
      filters.search = localStorage.getItem(LS_KEYS.search) || '';
      filters.category = localStorage.getItem(LS_KEYS.category) || 'all';
      filters.sort = localStorage.getItem(LS_KEYS.sort) || 'featured';
      try{
        const savedChips = JSON.parse(localStorage.getItem(LS_KEYS.chips) || '[]');
        filters.chips = new Set(Array.isArray(savedChips) ? savedChips : []);
      }catch{ filters.chips = new Set(); }
    }

    function saveState(){
      localStorage.setItem(LS_KEYS.cart, JSON.stringify(cart));
      localStorage.setItem(LS_KEYS.coupon, appliedCoupon);
      localStorage.setItem(LS_KEYS.search, filters.search);
      localStorage.setItem(LS_KEYS.category, filters.category);
      localStorage.setItem(LS_KEYS.sort, filters.sort);
      localStorage.setItem(LS_KEYS.chips, JSON.stringify(Array.from(filters.chips)));
    }

    function getProductById(id){
      return PRODUCTS.find(p => p.id === id) || null;
    }

    function cartItems(){
      return Object.values(cart)
        .map(({id, qty}) => ({ product: getProductById(id), qty }))
        .filter(x => x.product && x.qty > 0);
    }

    function cartCount(){
      return cartItems().reduce((sum, it) => sum + it.qty, 0);
    }

    function calcSubtotal(){
      return cartItems().reduce((sum, it) => sum + it.product.price * it.qty, 0);
    }

    function calcShipping(subtotal){
      // Fictício: grátis >= 199; senão R$ 19,90; e para carrinho vazio R$ 0
      if(subtotal <= 0) return 0;
      if(subtotal >= 199) return 0;
      return 19.90;
    }

    function calcDiscount(subtotal){
      const code = (appliedCoupon || '').trim().toUpperCase();
      if(!code || subtotal <= 0) return 0;

      if(code === 'ATLAS10'){
        const d = subtotal * 0.10;
        return Math.min(50, d);
      }
      if(code === 'KITS'){
        const kitTotal = cartItems()
          .filter(it => it.product.tags.includes('kit'))
          .reduce((sum, it) => sum + it.product.price * it.qty, 0);
        return kitTotal * 0.15;
      }
      // FRETEGRATIS handled in shipping adjustment
      return 0;
    }

    function isValidCoupon(code){
      const c = (code || '').trim().toUpperCase();
      return ['ATLAS10', 'FRETEGRATIS', 'KITS'].includes(c);
    }

    // -----------------------------
    // UI: Chips
    // -----------------------------
    function renderChips(){
      document.querySelectorAll('.chip').forEach(btn => {
        const key = btn.dataset.chip;
        const active = filters.chips.has(key);
        btn.className = [
          'chip',
          'rounded-full px-4 py-2 text-sm font-semibold border',
          active ? 'bg-slate-900 text-white border-slate-900' : 'bg-white text-slate-700 border-slate-200 hover:bg-slate-50'
        ].join(' ');
        btn.textContent = CHIP_LABELS[key] || key;
        btn.setAttribute('aria-pressed', active ? 'true' : 'false');
      });
    }

    // -----------------------------
    // UI: Products
    // -----------------------------
    function uniqueCategories(){
      const set = new Set(PRODUCTS.map(p => p.category));
      return Array.from(set).sort((a,b) => a.localeCompare(b));
    }

    function renderCategorySelect(){
      const select = $('categorySelect');
      const existing = Array.from(select.options).map(o => o.value);
      uniqueCategories().forEach(cat => {
        if(existing.includes(cat)) return;
        const opt = document.createElement('option');
        opt.value = cat;
        opt.textContent = cat;
        select.appendChild(opt);
      });
    }

    function matchesFilters(p){
      const s = filters.search.trim().toLowerCase();
      if(s){
        const hay = [p.name, p.category, p.desc, ...(p.tags||[])].join(' ').toLowerCase();
        if(!hay.includes(s)) return false;
      }
      if(filters.category !== 'all' && p.category !== filters.category) return false;
      if(filters.chips.size){
        // AND logic: product must contain all selected chips
        for(const chip of filters.chips){
          if(!(p.tags||[]).includes(chip)) return false;
        }
      }
      return true;
    }

    function sortProducts(list){
      const key = filters.sort;
      const arr = [...list];
      if(key === 'price-asc') arr.sort((a,b) => a.price - b.price);
      else if(key === 'price-desc') arr.sort((a,b) => b.price - a.price);
      else if(key === 'rating-desc') arr.sort((a,b) => b.rating - a.rating);
      else if(key === 'name-asc') arr.sort((a,b) => a.name.localeCompare(b.name));
      else {
        // featured: sort by tags/ratings
        const score = (p) => {
          let sc = 0;
          if(p.tags.includes('maisvendido')) sc += 30;
          if(p.tags.includes('novidade')) sc += 10;
          if(p.tags.includes('kit')) sc += 8;
          if(p.tags.includes('recuperacao')) sc += 6;
          sc += p.rating * 10;
          sc += Math.min(10, p.reviews / 50);
          return sc;
        };
        arr.sort((a,b) => score(b) - score(a));
      }
      return arr;
    }

    function productBadge(p){
      const tags = p.tags || [];
      if(tags.includes('maisvendido')) return { label: 'Mais vendido', cls: 'bg-slate-900 text-white' };
      if(tags.includes('novidade')) return { label: 'Novidade', cls: 'bg-blue-600 text-white' };
      if(tags.includes('kit')) return { label: 'Kit', cls: 'bg-fuchsia-600 text-white' };
      if(tags.includes('recuperacao')) return { label: 'Recuperação', cls: 'bg-emerald-600 text-white' };
      if(tags.includes('fretegratis')) return { label: 'Frete grátis*', cls: 'bg-amber-300 text-slate-900' };
      return null;
    }

    function renderProducts(){
      const grid = $('productGrid');
      grid.innerHTML = '';

      const filtered = PRODUCTS.filter(matchesFilters);
      const sorted = sortProducts(filtered);

      $('resultsCount').textContent = String(sorted.length);
      $('emptyState').classList.toggle('hidden', sorted.length !== 0);

      for(const p of sorted){
        const badge = productBadge(p);
        const el = document.createElement('article');
        el.className = 'rounded-3xl border border-slate-200 bg-white overflow-hidden hover:shadow-lg transition-shadow';

        const inCartQty = cart[p.id]?.qty || 0;

        el.innerHTML = `
          <div class="relative">
            <img alt="${escapeHtml(p.name)}" src="${escapeHtml(p.image)}" class="h-48 w-full object-cover" loading="lazy" />
            ${badge ? `<div class="absolute top-3 left-3 text-xs font-extrabold px-3 py-1.5 rounded-full ${badge.cls}">${escapeHtml(badge.label)}</div>` : ''}
            <button data-action="details" data-id="${p.id}" class="absolute top-3 right-3 rounded-full bg-white/90 hover:bg-white border border-slate-200 px-3 py-1.5 text-xs font-bold focus-ring">Detalhes</button>
          </div>
          <div class="p-5">
            <div class="flex items-start justify-between gap-3">
              <div>
                <div class="text-xs font-semibold text-slate-500">${escapeHtml(p.category)}</div>
                <h3 class="mt-1 font-extrabold leading-snug">${escapeHtml(p.name)}</h3>
              </div>
              <div class="text-right">
                <div class="text-lg font-black">${BRL.format(p.price)}</div>
                <div class="text-xs text-slate-500">em até 12x (demo)</div>
              </div>
            </div>

            <div class="mt-2 flex items-center justify-between">
              <div class="text-sm text-slate-600" title="Avaliação">
                <span class="text-amber-500">${toStars(p.rating)}</span>
                <span class="ml-1">${p.rating.toFixed(1)}</span>
                <span class="text-slate-400">(${p.reviews})</span>
              </div>
              <div class="text-xs font-semibold ${p.stock > 10 ? 'text-emerald-700' : 'text-amber-700'}">${p.stock > 10 ? 'Em estoque' : 'Últimas unidades'}</div>
            </div>

            <div class="mt-4 flex flex-col sm:flex-row gap-2">
              <button data-action="add" data-id="${p.id}" class="rounded-xl bg-slate-900 text-white px-4 py-2.5 text-sm font-bold hover:bg-slate-800 focus-ring w-full">Adicionar</button>
              <button data-action="quick" data-id="${p.id}" class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-4 py-2.5 text-sm font-semibold focus-ring w-full">${inCartQty ? `+1 (no carrinho: ${inCartQty})` : 'Adicionar +1'}</button>
            </div>

            <div class="mt-3 text-xs text-slate-500">Tags: ${(p.tags||[]).map(t => `<span class="inline-block mr-1 rounded-lg bg-slate-100 px-2 py-1">${escapeHtml(CHIP_LABELS[t] || t)}</span>`).join('') || '<span class="text-slate-400">—</span>'}</div>
          </div>
        `;

        grid.appendChild(el);
      }
    }

    function renderFeatured(){
      const target = $('featuredRow');
      const picks = sortProducts(PRODUCTS).slice(0, 4);
      target.innerHTML = '';
      for(const p of picks){
        const badge = productBadge(p);
        const card = document.createElement('div');
        card.className = 'rounded-2xl overflow-hidden border border-white/15 bg-white/10 hover:bg-white/15 transition-colors';
        card.innerHTML = `
          <button class="w-full text-left" data-action="details" data-id="${p.id}">
            <div class="relative">
              <img alt="${escapeHtml(p.name)}" class="h-28 w-full object-cover opacity-90" src="${escapeHtml(p.image)}" loading="lazy" />
              ${badge ? `<div class="absolute top-2 left-2 text-[11px] font-extrabold px-2.5 py-1 rounded-full ${badge.cls}">${escapeHtml(badge.label)}</div>` : ''}
            </div>
            <div class="p-3">
              <div class="text-white/70 text-xs">${escapeHtml(p.category)}</div>
              <div class="text-white font-extrabold leading-snug">${escapeHtml(p.name)}</div>
              <div class="mt-1 text-white font-black">${BRL.format(p.price)}</div>
            </div>
          </button>
        `;
        target.appendChild(card);
      }
    }

    // -----------------------------
    // UI: Modals
    // -----------------------------
    function openModal(modalEl){
      modalEl.classList.remove('hidden');
      modalEl.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
    }

    function closeModal(modalEl){
      modalEl.classList.add('hidden');
      modalEl.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }

    function openProductModal(id){
      const p = getProductById(id);
      if(!p) return;
      currentModalProductId = id;
      $('modalTitle').textContent = p.name;
      $('modalSubtitle').textContent = `${p.category} • ${(p.tags||[]).map(t => CHIP_LABELS[t] || t).join(', ') || 'sem tags'}`;
      $('modalImage').src = p.image;
      $('modalImage').alt = p.name;
      $('modalPrice').textContent = BRL.format(p.price);
      $('modalStock').textContent = String(p.stock);
      $('modalRating').innerHTML = `<span class="text-amber-500">${toStars(p.rating)}</span> <span class="ml-1">${p.rating.toFixed(1)}</span> <span class="text-slate-400">(${p.reviews})</span>`;
      $('modalDesc').textContent = p.desc;
      $('modalUse').textContent = p.use;
      $('modalHighlight').textContent = p.highlight;
      openModal($('productModal'));
      $('btnModalAdd').focus();
    }

    // -----------------------------
    // Cart operations
    // -----------------------------
    function addToCart(id, qty=1){
      const p = getProductById(id);
      if(!p) return;
      const current = cart[id]?.qty || 0;
      const newQty = clamp(current + qty, 0, p.stock);
      cart[id] = { id, qty: newQty };
      if(newQty === 0) delete cart[id];
      saveState();
      renderAll();
      toast(`${p.name} adicionado ao carrinho`, 'ok');
    }

    function setQty(id, qty){
      const p = getProductById(id);
      if(!p) return;
      const newQty = clamp(qty, 0, p.stock);
      if(newQty <= 0) delete cart[id];
      else cart[id] = { id, qty: newQty };
      saveState();
      renderAll();
    }

    function clearCart(){
      cart = {};
      saveState();
      renderAll();
      toast('Carrinho esvaziado', 'warn');
    }

    function applyCoupon(code){
      const c = (code || '').trim().toUpperCase();
      if(!c){
        appliedCoupon = '';
        saveState();
        renderAll();
        toast('Cupom removido', 'info');
        return;
      }
      if(!isValidCoupon(c)){
        toast('Cupom inválido. Tente ATLAS10, FRETEGRATIS ou KITS.', 'err');
        return;
      }
      appliedCoupon = c;
      saveState();
      renderAll();
      toast(`Cupom aplicado: ${c}`, 'ok');
    }

    // -----------------------------
    // UI: Cart
    // -----------------------------
    function openCart(){
      const drawer = $('cartDrawer');
      drawer.setAttribute('aria-hidden', 'false');
      drawer.classList.remove('translate-x-full');
      $('cartBackdrop').classList.remove('opacity-0');
      $('cartBackdrop').classList.add('opacity-100');
      document.body.style.overflow = 'hidden';
      setTimeout(() => $('btnCloseCart').focus(), 0);
    }

    function closeCart(){
      const drawer = $('cartDrawer');
      drawer.setAttribute('aria-hidden', 'true');
      drawer.classList.add('translate-x-full');
      $('cartBackdrop').classList.add('opacity-0');
      $('cartBackdrop').classList.remove('opacity-100');
      document.body.style.overflow = '';
    }

    function renderCart(){
      const list = $('cartList');
      const items = cartItems();
      list.innerHTML = '';

      $('couponInput').value = appliedCoupon || '';

      if(items.length === 0){
        list.innerHTML = `
          <div class="rounded-3xl border border-dashed border-slate-300 bg-slate-50 p-6 text-center">
            <div class="font-extrabold">Seu carrinho está vazio</div>
            <p class="mt-2 text-sm text-slate-600">Adicione produtos para simular o checkout.</p>
            <button id="btnGoProducts" class="mt-4 rounded-xl bg-slate-900 text-white px-4 py-2.5 text-sm font-semibold hover:bg-slate-800 focus-ring">Ver produtos</button>
          </div>
        `;
        setTimeout(() => {
          const btn = $('btnGoProducts');
          if(btn) btn.onclick = () => {
            closeCart();
            document.querySelector('#produtos')?.scrollIntoView({behavior:'smooth'});
          };
        }, 0);
      } else {
        for(const {product:p, qty} of items){
          const row = document.createElement('div');
          row.className = 'rounded-3xl border border-slate-200 bg-white p-4';
          row.innerHTML = `
            <div class="flex gap-3">
              <img alt="${escapeHtml(p.name)}" src="${escapeHtml(p.image)}" class="size-16 rounded-2xl object-cover border border-slate-200" />
              <div class="min-w-0 flex-1">
                <div class="flex items-start justify-between gap-3">
                  <div class="min-w-0">
                    <div class="font-extrabold truncate">${escapeHtml(p.name)}</div>
                    <div class="text-xs text-slate-500">${escapeHtml(p.category)} • ${BRL.format(p.price)} un.</div>
                  </div>
                  <button data-cart-action="remove" data-id="${p.id}" class="rounded-xl border border-slate-200 bg-white hover:bg-slate-50 px-3 py-2 text-xs font-semibold focus-ring">Remover</button>
                </div>

                <div class="mt-3 flex items-center justify-between gap-3">
                  <div class="inline-flex items-center gap-2 rounded-2xl border border-slate-200 bg-slate-50 p-1">
                    <button data-cart-action="dec" data-id="${p.id}" class="rounded-xl bg-white border border-slate-200 px-3 py-2 text-sm font-bold hover:bg-slate-50 focus-ring" aria-label="Diminuir">−</button>
                    <div class="px-2 text-sm font-extrabold w-10 text-center">${qty}</div>
                    <button data-cart-action="inc" data-id="${p.id}" class="rounded-xl bg-white border border-slate-200 px-3 py-2 text-sm font-bold hover:bg-slate-50 focus-ring" aria-label="Aumentar">+</button>
                  </div>
                  <div class="text-sm font-black">${BRL.format(p.price * qty)}</div>
                </div>
              </div>
            </div>
          `;
          list.appendChild(row);
        }
      }

      $('cartItemsCount').textContent = String(cartCount());
      $('cartCountBadge').textContent = String(cartCount());

      const subtotal = calcSubtotal();
      let shipping = calcShipping(subtotal);
      const discount = calcDiscount(subtotal);

      if((appliedCoupon || '').toUpperCase() === 'FRETEGRATIS'){
        shipping = 0;
      }

      const total = Math.max(0, subtotal + shipping - discount);

      $('subtotal').textContent = BRL.format(subtotal);
      $('shipping').textContent = BRL.format(shipping);
      $('discount').textContent = `- ${BRL.format(discount)}`;
      $('total').textContent = BRL.format(total);

      // Update checkout summary if open
      if(!$('checkoutModal').classList.contains('hidden')){
        renderCheckoutSummary();
      }
    }

    function renderCheckoutSummary(){
      const box = $('checkoutSummary');
      const items = cartItems();
      box.innerHTML = '';
      if(items.length === 0){
        box.innerHTML = '<div class="text-sm text-slate-600">Carrinho vazio.</div>';
        $('checkoutTotal').textContent = BRL.format(0);
        return;
      }

      const subtotal = calcSubtotal();
      let shipping = calcShipping(subtotal);
      const discount = calcDiscount(subtotal);
      if((appliedCoupon || '').toUpperCase() === 'FRETEGRATIS') shipping = 0;
      const total = Math.max(0, subtotal + shipping - discount);

      for(const {product:p, qty} of items){
        const row = document.createElement('div');
        row.className = 'flex items-center justify-between gap-3 text-sm';
        row.innerHTML = `
          <div class="min-w-0">
            <div class="font-semibold truncate">${escapeHtml(p.name)}</div>
            <div class="text-xs text-slate-500">${qty} × ${BRL.format(p.price)}</div>
          </div>
          <div class="font-extrabold">${BRL.format(p.price * qty)}</div>
        `;
        box.appendChild(row);
      }

      const meta = document.createElement('div');
      meta.className = 'mt-3 pt-3 border-t border-slate-200 space-y-1 text-sm';
      meta.innerHTML = `
        <div class="flex items-center justify-between"><span class="text-slate-600">Subtotal</span><span class="font-semibold">${BRL.format(subtotal)}</span></div>
        <div class="flex items-center justify-between"><span class="text-slate-600">Frete</span><span class="font-semibold">${BRL.format(shipping)}</span></div>
        <div class="flex items-center justify-between"><span class="text-slate-600">Desconto</span><span class="font-semibold text-emerald-700">- ${BRL.format(discount)}</span></div>
        <div class="flex items-center justify-between"><span class="text-slate-600">Cupom</span><span class="font-semibold">${escapeHtml(appliedCoupon || '—')}</span></div>
      `;
      box.appendChild(meta);

      $('checkoutTotal').textContent = BRL.format(total);
    }

    // -----------------------------
    // Render all
    // -----------------------------
    function renderAll(){
      renderChips();
      renderProducts();
      renderCart();
    }

    // -----------------------------
    // Events
    // -----------------------------
    function setupEvents(){
      $('year').textContent = String(new Date().getFullYear());

      $('btnMobileMenu').addEventListener('click', () => {
        $('mobileMenu').classList.toggle('hidden');
      });

      $('btnScrollProducts').addEventListener('click', () => {
        document.querySelector('#produtos')?.scrollIntoView({behavior:'smooth'});
      });

      $('btnScrollTop').addEventListener('click', () => {
        document.querySelector('#inicio')?.scrollIntoView({behavior:'smooth'});
      });

      // Filters controls
      $('searchInput').addEventListener('input', (e) => {
        filters.search = e.target.value;
        saveState();
        renderAll();
      });

      $('categorySelect').addEventListener('change', (e) => {
        filters.category = e.target.value;
        saveState();
        renderAll();
      });

      $('sortSelect').addEventListener('change', (e) => {
        filters.sort = e.target.value;
        saveState();
        renderAll();
      });

      document.querySelectorAll('.chip').forEach(btn => {
        btn.addEventListener('click', () => {
          const key = btn.dataset.chip;
          if(filters.chips.has(key)) filters.chips.delete(key);
          else filters.chips.add(key);
          saveState();
          renderAll();
        });
      });

      $('btnClearFilters').addEventListener('click', () => {
        filters.search = '';
        filters.category = 'all';
        filters.sort = 'featured';
        filters.chips = new Set();
        saveState();
        $('searchInput').value = '';
        $('categorySelect').value = 'all';
        $('sortSelect').value = 'featured';
        renderAll();
        toast('Filtros limpos', 'info');
      });

      // Product grid clicks (delegation)
      $('productGrid').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if(!btn) return;
        const id = btn.dataset.id;
        const action = btn.dataset.action;
        if(!id || !action) return;
        if(action === 'details') openProductModal(id);
        if(action === 'add') { addToCart(id, 1); openCart(); }
        if(action === 'quick') addToCart(id, 1);
      });

      $('featuredRow').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if(!btn) return;
        const id = btn.dataset.id;
        const action = btn.dataset.action;
        if(action === 'details' && id) openProductModal(id);
      });

      // Product modal
      $('btnCloseProductModal').addEventListener('click', () => closeModal($('productModal')));
      $('productModalOverlay').addEventListener('click', () => closeModal($('productModal')));
      $('btnModalAdd').addEventListener('click', () => {
        if(currentModalProductId){
          addToCart(currentModalProductId, 1);
          openCart();
        }
      });
      $('btnModalBuyNow').addEventListener('click', () => {
        if(currentModalProductId){
          addToCart(currentModalProductId, 1);
          closeModal($('productModal'));
          openCart();
          openCheckout();
        }
      });

      // Coupons modal
      $('btnShowCoupons').addEventListener('click', () => {
        openModal($('couponsModal'));
        $('btnCloseCoupons').focus();
      });
      $('btnCloseCoupons').addEventListener('click', () => closeModal($('couponsModal')));
      $('couponsOverlay').addEventListener('click', () => closeModal($('couponsModal')));

      // Copy coupon buttons
      document.addEventListener('click', async (e) => {
        const btn = e.target.closest('.btnCopyCoupon');
        if(!btn) return;
        const code = (btn.dataset.coupon || '').toUpperCase();
        try{
          await navigator.clipboard.writeText(code);
          toast(`Cupom copiado: ${code}`, 'ok');
        }catch{
          toast(`Cupom: ${code} (copie manualmente)`, 'info');
        }
      });

      // Cart open/close
      const openers = ['btnOpenCart', 'btnOpenCartTop', 'btnOpenCartFooter'];
      openers.forEach(id => $(id).addEventListener('click', openCart));

      $('btnCloseCart').addEventListener('click', closeCart);
      $('cartBackdrop').addEventListener('click', closeCart);
      $('btnContinue').addEventListener('click', () => {
        closeCart();
        document.querySelector('#produtos')?.scrollIntoView({behavior:'smooth'});
      });
      $('btnClearCart').addEventListener('click', clearCart);

      $('cartList').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if(!btn) return;
        const id = btn.dataset.id;
        const act = btn.dataset.cartAction;
        if(!id || !act) return;
        const qty = cart[id]?.qty || 0;
        if(act === 'inc') setQty(id, qty + 1);
        if(act === 'dec') setQty(id, qty - 1);
        if(act === 'remove') setQty(id, 0);
      });

      $('btnApplyCoupon').addEventListener('click', () => applyCoupon($('couponInput').value));
      $('couponInput').addEventListener('keydown', (e) => {
        if(e.key === 'Enter'){
          e.preventDefault();
          applyCoupon($('couponInput').value);
        }
      });

      // Demo helpers
      $('btnAutoFill').addEventListener('click', () => {
        applyCoupon('ATLAS10');
        toast('Cupom ATLAS10 aplicado. Abra o carrinho para ver o desconto.', 'ok');
      });

      $('btnAddBundle').addEventListener('click', () => {
        // add a quick selection
        const ids = ['p20', 'p8', 'p4', 'p6'];
        ids.forEach(id => addToCart(id, 1));
        openCart();
      });

      $('btnResetDemo').addEventListener('click', () => {
        appliedCoupon = '';
        cart = {};
        filters.search = '';
        filters.category = 'all';
        filters.sort = 'featured';
        filters.chips = new Set();
        saveState();
        $('searchInput').value = '';
        $('categorySelect').value = 'all';
        $('sortSelect').value = 'featured';
        renderAll();
        toast('Demo resetada', 'warn');
      });

      // Newsletter demo
      $('btnNewsletter').addEventListener('click', () => {
        const val = $('newsletterEmail').value.trim();
        if(!val || !val.includes('@')){
          toast('Digite um e-mail válido (demo).', 'err');
          return;
        }
        $('newsletterEmail').value = '';
        toast('Inscrição registrada (demo)!', 'ok');
      });

      // Checkout
      $('btnCheckout').addEventListener('click', () => openCheckout());
      $('btnCloseCheckout').addEventListener('click', () => closeModal($('checkoutModal')));
      $('checkoutOverlay').addEventListener('click', () => closeModal($('checkoutModal')));
      $('btnBackToCart').addEventListener('click', () => {
        closeModal($('checkoutModal'));
        openCart();
      });

      $('checkoutForm').addEventListener('submit', (e) => {
        e.preventDefault();
        if(cartCount() === 0){
          toast('Seu carrinho está vazio.', 'err');
          return;
        }
        const form = new FormData(e.target);
        const name = String(form.get('name') || '').trim();
        const email = String(form.get('email') || '').trim();
        const zip = String(form.get('zip') || '').trim();
        if(name.length < 2 || !email.includes('@') || zip.length < 8){
          toast('Confira os campos obrigatórios.', 'err');
          return;
        }
        const orderId = `AF-${Date.now().toString().slice(-6)}`;
        toast(`Pedido confirmado (demo): ${orderId}`, 'ok');
        // Clear cart after placing demo order
        cart = {};
        appliedCoupon = '';
        saveState();
        renderAll();
        closeModal($('checkoutModal'));
        closeCart();
        document.querySelector('#inicio')?.scrollIntoView({behavior:'smooth'});
      });

      // Keyboard / global
      document.addEventListener('keydown', (e) => {
        if(e.key === 'Escape'){
          // Close in order: product modal, coupons, checkout, cart
          if(!$('productModal').classList.contains('hidden')) return closeModal($('productModal'));
          if(!$('couponsModal').classList.contains('hidden')) return closeModal($('couponsModal'));
          if(!$('checkoutModal').classList.contains('hidden')) return closeModal($('checkoutModal'));
          if(!$('cartDrawer').classList.contains('translate-x-full')) return closeCart();
        }
        if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k'){
          e.preventDefault();
          $('searchInput').focus();
        }
      });

      // Improve focus in toasts (none) and prevent accidental scroll lock conflicts
      window.addEventListener('resize', () => {
        // If nothing open, ensure scroll enabled
        const anyOpen =
          !$('productModal').classList.contains('hidden') ||
          !$('couponsModal').classList.contains('hidden') ||
          !$('checkoutModal').classList.contains('hidden') ||
          !$('cartDrawer').classList.contains('translate-x-full');
        if(!anyOpen) document.body.style.overflow = '';
      });
    }

    function openCheckout(){
      if(cartCount() === 0){
        toast('Adicione itens ao carrinho antes de finalizar.', 'warn');
        openCart();
        return;
      }
      renderCheckoutSummary();
      openModal($('checkoutModal'));
      // Keep cart open behind? We'll close cart for clarity
      closeCart();
      const firstField = document.querySelector('#checkoutForm input[name="name"]');
      setTimeout(() => firstField?.focus(), 0);
    }

    // -----------------------------
    // Init
    // -----------------------------
    function init(){
      loadState();
      renderCategorySelect();

      // Restore filters in UI
      $('searchInput').value = filters.search;
      $('categorySelect').value = filters.category;
      $('sortSelect').value = filters.sort;

      renderFeatured();
      setupEvents();
      renderAll();

      // First time hint
      setTimeout(() => {
        toast('Dica: Ctrl/⌘ + K para focar na busca.', 'info');
      }, 900);
    }

    init();
  </script>
</body>
</html>